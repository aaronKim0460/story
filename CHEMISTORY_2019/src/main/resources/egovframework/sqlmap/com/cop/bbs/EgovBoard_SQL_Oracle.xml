<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- 
	수정일                 수정자                          수정내용
  =========     =======    =================================================
  2011.09.07   	서준식     	 	NTCE_BGNDE, NTCE_ENDDE 컬럼 빈공간에 의한 비교 오류 때문에 Rtrim() 추가 
  2011.09.21    서준식              BBSManageDAO.selectMaxNttId문에 COMMIT 될때까지 LOCK설정
  2011.09.21    서준식              NTT_ID를 IDGENT서비스를 사용해서 생성하므로 BBSManageDAO.selectMaxNttId문은 실제 사용하지 않음
-->
<sqlMap namespace="Board">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias  alias="Board" type="egovframework.com.cop.bbs.service.Board"/>
	<typeAlias  alias="BoardVO" type="egovframework.com.cop.bbs.service.BoardVO"/>

	<resultMap id="boardList" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="nttId" column="NTT_ID" columnIndex="2"/>
		<result property="nttSj" column="NTT_SJ" columnIndex="3"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID" columnIndex="4"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" columnIndex="5"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" columnIndex="6"/>
		<result property="inqireCo" column="RDCNT" columnIndex="7"/>
		<result property="parnts" column="PARNTSCTT_NO" columnIndex="8"/>
		<result property="replyAt" column="ANSWER_AT" columnIndex="9"/>		
		<result property="replyLc" column="ANSWER_LC" columnIndex="10"/>
		<result property="useAt" column="USE_AT" columnIndex="11"/>
		<result property="atchFileId" column="ATCH_FILE_ID" columnIndex="12"/>
		<result property="ntceBgnde" column="NTCE_BGNDE" columnIndex="13"/>
		<result property="ntceEndde" column="NTCE_ENDDE" columnIndex="14"/>
		<result property="codeNm" column="CODE_NM" columnIndex="15"/>
		<result property="noticeAt" column="NOTICE_AT" columnIndex="16"/>
		<result property="nttCn" column="NTT_CN" columnIndex="17"/>
		<result property="extStr0" column="ETC0" columnIndex="18"/>		
		<result property="extStr1" column="ETC1" columnIndex="19"/>
		<result property="extStr2" column="ETC2" columnIndex="20"/>
		<result property="extStr3" column="ETC3" columnIndex="21"/>
		<result property="extStr4" column="ETC4" columnIndex="22"/>
		<result property="extStr5" column="ETC5" columnIndex="23"/>
		<result property="extStr6" column="ETC6" columnIndex="24"/>
		<result property="extStr7" column="ETC7" columnIndex="25"/>
		<result property="extStr8" column="ETC8" columnIndex="26"/>
		<result property="extStr9" column="ETC9" columnIndex="27"/>
		<result property="publicNuriTy" column="PUBLIC_NURI_TY_CODE" columnIndex="28"/>
		<result property="confmSttus" column="CONFM_STTUS_CODE" columnIndex="29"/>
		<result property="ntceDate" column="NTCE_DT" columnIndex="30"/>
		<result property="totCnt" column="TOT_CNT" columnIndex="31"/>
		<result property="nttSe" column="NTT_SE_CODE" columnIndex="32"/>
		<result property="ntceDateH" column="NTCE_DT_H" columnIndex="33"/>
		<result property="cl1DetailCode" column="CL1_DETAIL_CODE" columnIndex="34"/>
		<result property="cl2DetailCode" column="CL2_DETAIL_CODE" columnIndex="35"/>
		<result property="cl3DetailCode" column="CL3_DETAIL_CODE" columnIndex="36"/>
		<result property="cl1DetailCodeNm" column="CL1_DETAIL_CODE_NM" columnIndex="37"/>
		<result property="cl2DetailCodeNm" column="CL2_DETAIL_CODE_NM" columnIndex="38"/>
		<result property="thumbFileId" column="THUMB_FILE_ID" columnIndex="39"/>
		<result property="meterialId" column="METERIAL_ID" columnIndex="40"/>
		<result property="meterialName" column="METERIAL_NAME" columnIndex="41"/>
	</resultMap>

	<resultMap id="boardList2" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="nttId" column="NTT_ID" columnIndex="2"/>
		<result property="nttSj" column="NTT_SJ" columnIndex="3"/>
		<result property="ntceDate" column="NTCE_DT" columnIndex="4"/>
		<result property="atchFileId" column="ATCH_FILE_ID" columnIndex="5"/>
		<result property="totCnt" column="TOT_CNT" columnIndex="6"/>
		<result property="menuNm" column="MENU_NM" columnIndex="7"/>
		<result property="goUrl" column="GO_URL" columnIndex="8"/>
		<result property="rdCnt" column="RDCNT" columnIndex="9"/>
	</resultMap>
			         
	<resultMap id="boardList3" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="menuNm" column="MENU_NM" columnIndex="2"/>
		<result property="grCnt" column="GR_CNT" columnIndex="3"/>
	</resultMap>
				         
	<resultMap id="boardImgList" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="nttId" column="NTT_ID" columnIndex="2"/>
		<result property="nttSj" column="NTT_SJ" columnIndex="3"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID" columnIndex="4"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" columnIndex="5"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" columnIndex="6"/>
		<result property="inqireCo" column="RDCNT" columnIndex="7"/>
		<result property="parnts" column="PARNTSCTT_NO" columnIndex="8"/>
		<result property="replyAt" column="ANSWER_AT" columnIndex="9"/>		
		<result property="replyLc" column="ANSWER_LC" columnIndex="10"/>
		<result property="useAt" column="USE_AT" columnIndex="11"/>
		<result property="atchFileId" column="ATCH_FILE_ID" columnIndex="12"/>
		<result property="ntceBgnde" column="NTCE_BGNDE" columnIndex="13"/>
		<result property="ntceEndde" column="NTCE_ENDDE" columnIndex="14"/>
		<result property="extStr5" column="ETC5" columnIndex="15"/>
		<result property="fileStreCours" column="FILE_STRE_COURS" columnIndex="16"/>
		<result property="streFileNm" column="STRE_FILE_NM" columnIndex="17"/>
		<result property="orignlFileNm" column="ORIGNL_FILE_NM" columnIndex="18"/>
		<result property="fileExtn" column="FILE_EXTSN" columnIndex="19"/>
		<result property="noticeAt" column="NOTICE_AT" columnIndex="20"/>
		<result property="nttCn" column="NTT_CN" columnIndex="21"/>
		<result property="fileSn" column="FILE_SN" columnIndex="22"/>
		<result property="publicNuriTy" column="PUBLIC_NURI_TY_CODE" columnIndex="23"/>
		<result property="confmSttus" column="CONFM_STTUS_CODE" columnIndex="24"/>
		<result property="ntceDate" column="NTCE_DT" columnIndex="25"/>
		<result property="totCnt" column="TOT_CNT" columnIndex="26"/>
		<result property="ntceDateH" column="NTCE_DT_H" columnIndex="27"/>	
		<result property="cl1DetailCode" column="CL1_DETAIL_CODE" columnIndex="28"/>
		<result property="cl2DetailCode" column="CL2_DETAIL_CODE" columnIndex="29"/>	
		<result property="cl1DetailCodeNm" column="CL1_DETAIL_CODE_NM" columnIndex="30"/>
		<result property="cl2DetailCodeNm" column="CL2_DETAIL_CODE_NM" columnIndex="31"/>
	</resultMap>
	
	<resultMap id="boardDetail" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="nttId" column="NTT_ID" columnIndex="2"/>
		<result property="nttSj" column="NTT_SJ" columnIndex="3"/>	
		<result property="ntcrId" column="NTCR_ID" columnIndex="4"/>
		<result property="ntcrNm" column="NTCR_NM" columnIndex="5"/>
		<result property="nttNo" column="NTT_NO" columnIndex="6"/>
		<result property="nttCn" column="NTT_CN" columnIndex="7"/>
		<result property="password" column="PASSWORD" columnIndex="8"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID" columnIndex="9"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" columnIndex="10"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" columnIndex="11"/>
		<result property="ntceBgnde" column="NTCE_BGNDE" columnIndex="12"/>
		<result property="ntceEndde" column="NTCE_ENDDE" columnIndex="13"/>
		<result property="inqireCo" column="RDCNT" columnIndex="14"/>
		<result property="useAt" column="USE_AT" columnIndex="15"/>
		<result property="atchFileId" column="ATCH_FILE_ID" columnIndex="16"/>
		<result property="parnts" column="PARNTSCTT_NO" columnIndex="17"/>
		<result property="replyAt" column="ANSWER_AT" columnIndex="18"/>	
		<result property="replyLc" column="ANSWER_LC" columnIndex="19"/>
		<result property="sortOrdr" column="SORT_ORDR" columnIndex="19"/>
		<result property="bbsTyCode" column="BBS_TY_CODE" columnIndex="20"/>
		<result property="bbsAttrbCode" column="BBS_ATTRB_CODE" columnIndex="21"/>
		<result property="replyPosblAt" column="REPLY_POSBL_AT" columnIndex="22"/>
		<result property="fileAtchPosblAt" column="FILE_ATCH_POSBL_AT" columnIndex="23"/>
		<result property="posblAtchFileNumber" column="ATCH_POSBL_FILE_NUMBER" columnIndex="24"/>
		<result property="bbsNm" column="BBS_NM" columnIndex="25"/>
		<result property="codeNm" column="CODE_NM" columnIndex="26"/>
		<result property="extStr0" column="ETC0" columnIndex="27"/>
		<result property="extStr1" column="ETC1" columnIndex="28"/>
		<result property="extStr2" column="ETC2" columnIndex="29"/>
		<result property="extStr3" column="ETC3" columnIndex="30"/>
		<result property="extStr4" column="ETC4" columnIndex="31"/>
		<result property="extStr5" column="ETC5" columnIndex="32"/>
		<result property="extStr6" column="ETC6" columnIndex="33"/>
		<result property="extStr7" column="ETC7" columnIndex="34"/>
		<result property="extStr8" column="ETC8" columnIndex="35"/>
		<result property="extStr9" column="ETC9" columnIndex="36"/>
		<result property="noticeAt" column="NOTICE_AT" columnIndex="37"/>
		<result property="publicNuriTy" column="PUBLIC_NURI_TY_CODE" columnIndex="38"/>
		<result property="confmSttus" column="CONFM_STTUS_CODE" columnIndex="39"/>
		<result property="ntceDate" column="NTCE_DT" columnIndex="40"/>
		<result property="nextNttId" column="NEXT_NTT_ID" columnIndex="41"/>
		<result property="preNttId" column="PRE_NTT_ID" columnIndex="42"/>
		<result property="nextNttSj" column="NEXT_NTT_SJ" columnIndex="43"/>
		<result property="preNttSj" column="PRE_NTT_SJ" columnIndex="44"/>
		<result property="ntceDateH" column="NTCE_DT_H" columnIndex="45"/>
		<result property="cl1DetailCode" column="CL1_DETAIL_CODE" columnIndex="46"/>
		<result property="cl2DetailCode" column="CL2_DETAIL_CODE" columnIndex="47"/>
		<result property="cl3DetailCode" column="CL3_DETAIL_CODE" columnIndex="48"/>
		<result property="cl1DetailCodeNm" column="CL1_DETAIL_CODE_NM" columnIndex="49"/>
		<result property="cl2DetailCodeNm" column="CL2_DETAIL_CODE_NM" columnIndex="50"/>
		<result property="keywordTag" column="KEYWORD_TAG" columnIndex="51"/>
		<result property="thumbFileId" column="THUMB_FILE_ID" columnIndex="52"/>
		<result property="meterialId" column="METERIAL_ID" columnIndex="53"/>
		<result property="meterialName" column="METERIAL_NAME" columnIndex="54"/>
		<result property="meterialKname" column="METERIAL_KNAME" columnIndex="55"/>
		<result property="meterialCas" column="METERIAL_CAS" columnIndex="56"/>
		<result property="fileList" column="ATCH_FILE_ID" javaType="List" select="FileManageDAO.selectFileListByAtchFileId" />
	</resultMap>				
				
	<resultMap id="sortList" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="nttId" column="NTT_ID" columnIndex="2"/>
		<result property="sortOrdr" column="SORT_ORDR" columnIndex="3"/>
		<result property="parnts" column="PARNTSCTT_NO" columnIndex="4"/>
		<result property="nttNo" column="NTT_NO" columnIndex="5"/>		
		<result property="replyLc" column="ANSWER_LC" columnIndex="6"/>
	</resultMap>

	<resultMap id="guestList" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID" columnIndex="1"/>
		<result property="nttId" column="NTT_ID" columnIndex="2"/>
		<result property="nttSj" column="NTT_SJ" columnIndex="3"/>
		<result property="ntcrNm" column="NTCR_NM" columnIndex="4"/>
		<result property="password" column="PASSWORD" columnIndex="5"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" columnIndex="6"/>
		<result property="nttCn" column="NTT_CN" columnIndex="7"/>
		<result property="useAt" column="USE_AT" columnIndex="8"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" columnIndex="9"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID" columnIndex="10"/>
	</resultMap>

	
 	<select id="BBSManageDAO.selectMaxNttId" resultClass="java.lang.Long">
 		/* BBSManageDAO.selectMaxNttId */
 		<![CDATA[
			SELECT NVL(NTT_ID,0)+1 AS NTT_ID FROM TN_BBS WHERE NTT_ID=(SELECT MAX(NTT_ID) AS NTT_ID  FROM TN_BBS) FOR UPDATE WAIT 3  
 		]]>
 	</select>
 	
	<insert id="BBSManageDAO.insertBoardArticle" parameterClass="Board" >
		<selectKey resultClass="java.lang.Long" keyProperty="nttNo">
			SELECT NVL(MAX(SORT_ORDR),0)+1 AS NTT_NO  FROM TN_BBS
			WHERE BBS_ID = #bbsId#
		</selectKey>
		/* BBSManageDAO.insertBoardArticle */
		<![CDATA[
			INSERT INTO TN_BBS
			(NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
			 NTCR_ID, NTCR_NM, PASSWORD, RDCNT, 
			 NTCE_BGNDE, NTCE_ENDDE, ANSWER_AT,  			   
			 PARNTSCTT_NO, NTT_NO, ANSWER_LC, ATCH_FILE_ID,
			 FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT, NOTICE_AT,
			 CL1_DETAIL_CODE, CL2_DETAIL_CODE, CL3_DETAIL_CODE,
			 ETC0, ETC1, ETC2, ETC3, ETC4,
			 ETC5, ETC6, ETC7, ETC8, ETC9, PUBLIC_NURI_TY_CODE, CONFM_STTUS_CODE, NTCE_DT, THUMB_FILE_ID, METERIAL_ID,
			 METERIAL_KNAME, METERIAL_CAS
			 )
			VALUES
			( #nttId#, #bbsId#, #nttSj#, #nttCn#, #nttNo#, 
			  #ntcrId#, #ntcrNm#, #password#, #inqireCo#, 
			  TO_DATE(#ntceBgnde#,'YYYY-MM-DD'), TO_DATE(#ntceEndde#,'YYYY-MM-DD'), #replyAt#, 
			  #parnts#, 1, #replyLc#, #atchFileId#,
			  #frstRegisterId#, SYSDATE, 'Y', #noticeAt#,
			  #cl1DetailCode#, #cl2DetailCode#, #cl3DetailCode# ,
			  #extStr0#, #extStr1#, #extStr2#, #extStr3#, #extStr4#,
			  #extStr5#, #extStr6#, #extStr7#, #extStr8#, #extStr9#, #publicNuriTy#, #confmSttus# , TO_DATE(NVL(#ntceDate#,TO_CHAR(SYSDATE,'YYYY-MM-DD')),'YYYY-MM-DD'), #thumbFileId#, #meterialId#,
			  #meterialKname#, #meterialCas#
			 )			
		]]>
	</insert>
	
	<insert id="BBSManageDAO.replyBoardArticle" parameterClass="Board" >
		<selectKey resultClass="java.lang.Long" keyProperty="nttNo">
			SELECT NVL(MAX(NTT_NO),0)+1 AS NTT_NO  FROM TN_BBS
			WHERE BBS_ID = #bbsId# AND SORT_ORDR = #sortOrdr#
		</selectKey>			
		/* BBSManageDAO.replyBoardArticle */
		<![CDATA[
			INSERT INTO TN_BBS
			(NTT_ID, BBS_ID, NTT_SJ, NTT_CN, SORT_ORDR, 
			 NTCR_ID, NTCR_NM, PASSWORD, RDCNT, 
			 NTCE_BGNDE, NTCE_ENDDE, ANSWER_AT,  			   
			 PARNTSCTT_NO, NTT_NO, ANSWER_LC, ATCH_FILE_ID,
			 FRST_REGISTER_ID, FRST_REGIST_PNTTM, USE_AT, NOTICE_AT,
			 CL1_DETAIL_CODE, CL2_DETAIL_CODE, 
			 ETC0, ETC1, ETC2, ETC3, ETC4,
			 ETC5, ETC6, ETC7, ETC8, ETC9, PUBLIC_NURI_TY_CODE, CONFM_STTUS_CODE, NTCE_DT
			 )
			VALUES
			( #nttId#, #bbsId#, #nttSj#, #nttCn#, #sortOrdr#, 
			  #ntcrId#, #ntcrNm#, #password#, #inqireCo#, 
			  TO_DATE(#ntceBgnde#,'YYYY-MM-DD'), TO_DATE(#ntceEndde#,'YYYY-MM-DD'), #replyAt#, 
			  #parnts#, 1, #replyLc#, #atchFileId#,
			  #frstRegisterId#, SYSDATE, 'Y', #noticeAt#,
			  #cl1DetailCode#, #cl2DetailCode#, 
			  #extStr0#, #extStr1#, #extStr2#, #extStr3#, #extStr4#,
			  #extStr5#, #extStr6#, #extStr7#, #extStr8#, #extStr9#, #publicNuriTy#, #confmSttus# , TO_DATE(NVL(#ntceDate#,TO_CHAR(SYSDATE,'YYYY-MM-DD')),'YYYY-MM-DD')
			 )			
		]]>
	</insert>	
	
	<select id="BBSManageDAO.selectNoticeListForSort" parameterClass="Board" resultMap="sortList">
		/* BBSManageDAO.selectNoticeListForSort */
		<![CDATA[			
			SELECT
				a.BBS_ID, a.NTT_ID, a.SORT_ORDR, a.PARNTSCTT_NO, a.NTT_NO, a.ANSWER_LC
			FROM
				TN_BBS a	
			WHERE
				a.BBS_ID = #bbsId#
			AND
				a.SORT_ORDR = #sortOrdr#
			ORDER BY  a.SORT_ORDR DESC, a.NTT_NO ASC	
		]]>						
	</select>

			
	<select id="BBSManageDAO.selectBoardArticleList" parameterClass="BoardVO" resultMap="boardList" >
		/* BBSManageDAO.selectBoardArticleList */
		<![CDATA[
		SELECT Z.*,(SELECT ntt_cn FROM TN_BBS WHERE ntt_id=Z.ntt_id and BBS_ID=Z.BBS_ID and	 rownum=1) AS ntt_cn FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, TO_CHAR(a.NTCE_BGNDE,'YYYYMMDD') NTCE_BGNDE, TO_CHAR(a.NTCE_ENDDE,'YYYYMMDD') NTCE_ENDDE, NTT_DOC_SE_CODE, 
				(select CODE_NM from TC_CMMN_DETAIL_CODE where CODE = a.NTT_SE_CODE) as CODE_NM, NVL(a.NOTICE_AT, 0) NOTICE_AT,
				a.ETC0, a.ETC1, a.ETC2, a.ETC3, a.ETC4, a.ETC5,
				a.ETC6, a.ETC7, a.ETC8, a.ETC9, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT,a.NTCE_DT AS NTCE_DT_H , a.NTT_SE_CODE,
				COUNT(1) OVER() AS TOT_CNT
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE
				,a.CL3_DETAIL_CODE
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
				, a.THUMB_FILE_ID
				, a.METERIAL_ID
				, (
					SELECT
						M_KNAME
					FROM
						TT_MATERIAL
					WHERE
						M_IDX = a.METERIAL_ID
				) AS METERIAL_NAME
			FROM
				TN_BBS a
			WHERE a.USE_AT = 'Y'
		]]>	
			<isEqual prepend="AND" property="viewTp" compareValue="T">
				<![CDATA[	 a.BBS_ID IN (#bbsId#)	]]>
			</isEqual>		
			<isNotEqual prepend="AND" property="viewTp" compareValue="T">
				<![CDATA[	 a.BBS_ID = #bbsId#	]]>
			</isNotEqual>				
			
			<isEqual property="confmSttus" compareValue="C">
				AND a.CONFM_STTUS_CODE = #confmSttus#
			</isEqual>
			
			<isNotEmpty prepend="AND" property="searchCl1DetailCode" >
				<![CDATA[	a.CL1_DETAIL_CODE = #searchCl1DetailCode# 		]]>
			</isNotEmpty>	
			
			<!-- 제목 -->
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	LOWER(a.NTT_SJ) LIKE LOWER('%' || #searchWrd# || '%') 		]]>
			</isEqual>
			<!-- 본문 -->
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	LOWER(a.NTT_CN) LIKE LOWER('%' || #searchWrd# || '%') 		]]>
			</isEqual>	
			<!-- 작성자 -->
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="T0">
				<![CDATA[	( ( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.NTT_CN LIKE '%' || #searchWrd# || '%' ) OR (a.ETC0 LIKE '%' || #searchWrd# || '%') ) ]]>
			</isEqual>				
			
			<isEqual prepend="AND" property="searchCnd" compareValue="TOT">
				<![CDATA[	(( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC0 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC1 LIKE '%' || #searchWrd# || '%' ))	]]>
			</isEqual>			
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC0">
				<![CDATA[	a.ETC0 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC1">
				<![CDATA[	a.ETC1 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC2">
				<![CDATA[	a.ETC2 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
						
			<isEqual prepend="AND" property="searchCnd" compareValue="01">
							a.ETC9 = '01' 	
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="02">
							a.ETC9 = '02' 	
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="03">
							a.ETC9 = '03' 	
			</isEqual>
			<isNotEmpty prepend="AND" property="nttSe" >
				<![CDATA[	a.NTT_SE_CODE = #nttSe# 		]]>
			</isNotEmpty>
			
			<isNotEmpty prepend="AND" property="searchKname" >
				<![CDATA[	a.METERIAL_KNAME = #searchKname# 		]]>
			</isNotEmpty>	

			<isNotEmpty prepend="AND" property="searchCas" >
				<![CDATA[	a.METERIAL_CAS = #searchCas# 		]]>
			</isNotEmpty>	
			
			<isEqual prepend="AND" property="searchCnd" compareValue="ALL">
				<![CDATA[	(( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC1 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC2 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC4 LIKE '%' || #searchWrd# || '%' ))	]]>
			</isEqual>				
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC4">
				<![CDATA[	a.ETC4 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>				
					
		<![CDATA[			
			ORDER BY 
		]]>
			<isEmpty property="subPageIndex">
				<![CDATA[	 NVL(A.NOTICE_AT, 0) DESC,	]]>
			</isEmpty>
			
		<![CDATA[	
				CASE 
					WHEN ANSWER_AT='N' THEN 
						DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) 
					ELSE 
						(SELECT DECODE(NTCE_DT, NULL, FRST_REGIST_PNTTM, '', FRST_REGIST_PNTTM, NTCE_DT) FROM TN_BBS WHERE NTT_ID=A.PARNTSCTT_NO) 
				END DESC
				, A.SORT_ORDR DESC, A.NTT_NO ASC
			) TB ) Z 
		]]>				
		
			<isEqual property="bbsSearchTerm" compareValue="0">
				<![CDATA[	WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage# 		]]>
			</isEqual>	
	</select>	
	
	<select id="BBSManageDAO.selectBoardArticleList2" parameterClass="BoardVO" resultMap="boardList2" >
		/* BBSManageDAO.selectBoardArticleList2 */
		<![CDATA[
			SELECT   A.BBS_ID AS BBS_ID,
			         A.NTT_ID AS NTT_ID,
			         A.NTT_SJ AS NTT_SJ,
			         A.RDCNT AS RDCNT,
			         TO_CHAR(A.NTCE_DT,'YYYY-MM-DD') AS NTCE_DT,
			         A.ATCH_FILE_ID AS ATCH_FILE_ID,
			         COUNT(1) OVER() AS TOT_CNT,
			         Z.MENU_NM AS MENU_NM,
			         '/user/cop/bbs/selectBoardArticle.do?nttId='||A.NTT_ID||'&bbsId='||A.BBS_ID||'&menuNo='||Z.MENU_ID AS GO_URL
			FROM     TN_BBS A,
			         (SELECT SUBSTR(B.URL,(INSTR(B.URL,'=')+1),20) AS BBS_ID,
			                 C.MENU_ID,
			                 C.PROGRM_FILE_NM,
			                 C.MENU_NM,
			                 B.URL 
			         FROM    TN_MENU_INFO C,
			                 TN_PROGRM_LIST B
			         WHERE   C.PROGRM_FILE_NM = B.PROGRM_FILE_NM
			         AND     C.MENU_SITE_CODE ='SITE0001'
			         AND     B.URL LIKE ('%BBSMSTR%')) Z
			WHERE    A.USE_AT                     = 'Y'
			AND      A.BBS_ID                     = Z.BBS_ID
			AND      TO_CHAR(SYSDATE,'YYYYMMDD') >= TO_CHAR(A.NTCE_BGNDE,'YYYYMMDD')
			AND      TO_CHAR(SYSDATE,'YYYYMMDD') < TO_CHAR(A.NTCE_ENDDE,'YYYYMMDD')
			AND      CONFM_STTUS_CODE             ='C'
			AND 	 A.NTT_SJ LIKE '%' || #searchWrd# || '%'
			ORDER BY Z.BBS_ID ASC
		]]>
	</select>	
	
	<select id="BBSManageDAO.selectBoardArticleList3" parameterClass="BoardVO" resultMap="boardList3" >
		/* BBSManageDAO.selectBoardArticleList3 */
		<![CDATA[
			SELECT   A.BBS_ID AS BBS_ID,
		]]>
		<isEmpty property="searchWrd" >
		<![CDATA[
					 0  AS GR_CNT,
		]]>
		</isEmpty>
		<isNotEmpty property="searchWrd" >
		<![CDATA[
					COUNT(1)  AS GR_CNT,
		]]>
		</isNotEmpty>
		<![CDATA[
			         Z.MENU_NM AS MENU_NM
			FROM     TN_BBS A,
			         (SELECT SUBSTR(B.URL,(INSTR(B.URL,'=')+1),20) AS BBS_ID,
			                 C.MENU_ID,
			                 C.PROGRM_FILE_NM,
			                 C.MENU_NM,
			                 B.URL
			         FROM    TN_MENU_INFO C,
			                 TN_PROGRM_LIST B
			         WHERE   C.PROGRM_FILE_NM = B.PROGRM_FILE_NM
			         AND     C.MENU_SITE_CODE ='SITE0001'
			         AND     B.URL         LIKE ('%BBSMSTR%')) Z
			WHERE    A.USE_AT                     = 'Y'
			AND      A.BBS_ID                     = Z.BBS_ID
			AND      TO_CHAR(SYSDATE,'YYYYMMDD') >= TO_CHAR(A.NTCE_BGNDE,'YYYYMMDD')
			AND      TO_CHAR(SYSDATE,'YYYYMMDD') < TO_CHAR(A.NTCE_ENDDE,'YYYYMMDD')
			AND      CONFM_STTUS_CODE             ='C'
			AND 	 A.NTT_SJ LIKE '%' || #searchWrd# || '%'
			GROUP BY A.BBS_ID, Z.MENU_NM
			ORDER BY A.BBS_ID ASC
		]]>
	</select>	
	
	<select id="BBSManageDAO.selectBoardArticleListCnt" parameterClass="BoardVO" resultClass="java.lang.Integer" >
		/* BBSManageDAO.selectBoardArticleListCnt */
		<![CDATA[
			SELECT
				COUNT(a.NTT_ID)
			FROM
				TN_BBS a
			WHERE a.USE_AT = 'Y'
		]]>
			<isEqual prepend="AND" property="viewTp" compareValue="T">
				<![CDATA[	 a.BBS_ID IN (#bbsId#)	]]>
			</isEqual>		
			<isNotEqual prepend="AND" property="viewTp" compareValue="T">
				<![CDATA[	 a.BBS_ID = #bbsId#	]]>
			</isNotEqual>
		
			<isEqual property="confmSttus" compareValue="C">
				AND a.CONFM_STTUS_CODE = #confmSttus#
			</isEqual>
			
			<isNotEmpty prepend="AND" property="searchCl1DetailCode" >
				<![CDATA[	a.CL1_DETAIL_CODE = #searchCl1DetailCode# 		]]>
			</isNotEmpty>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	LOWER(a.NTT_SJ) LIKE LOWER('%' || #searchWrd# || '%') 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	LOWER(a.NTT_CN) LIKE LOWER('%' || #searchWrd# || '%') 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="T0">
				<![CDATA[	( ( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.NTT_CN LIKE '%' || #searchWrd# || '%' ) ) ]]>
			</isEqual>				
			
			<isEqual prepend="AND" property="searchCnd" compareValue="TOT">
				<![CDATA[	(( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC0 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC1 LIKE '%' || #searchWrd# || '%' ))	]]>
			</isEqual>			
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC0">
				<![CDATA[	a.ETC0 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC1">
				<![CDATA[	a.ETC1 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC2">
				<![CDATA[	a.ETC2 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
						
			<isEqual prepend="AND" property="searchCnd" compareValue="01">
							a.ETC9 = '01' 	
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="02">
							a.ETC9 = '02' 	
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="03">
							a.ETC9 = '03' 	
			</isEqual>
			<isNotEmpty prepend="AND" property="nttSe" >
				<![CDATA[	a.NTT_SE_CODE = #nttSe# 		]]>
			</isNotEmpty>	
			
			<isEqual prepend="AND" property="searchCnd" compareValue="ALL">
				<![CDATA[	(( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC1 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC2 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC4 LIKE '%' || #searchWrd# || '%' ))	]]>
			</isEqual>				
			<isEqual prepend="AND" property="searchCnd" compareValue="ETC4">
				<![CDATA[	a.ETC4 LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>						
	</select>	
 
	<select id="BBSManageDAO.selectBoardArticle" parameterClass="BoardVO" resultMap="boardDetail" >
		/* BBSManageDAO.selectBoardArticle */
		<![CDATA[
			SELECT * 
			  FROM (SELECT ROWNUM rn, 
		  				   LEAD(NTT_ID,1) OVER (ORDER BY ROWNUM) AS PRE_NTT_ID,
	                       LAG(NTT_ID,1) OVER (ORDER BY ROWNUM ) AS NEXT_NTT_ID,
	                       LEAD(NTT_SJ,1) OVER (ORDER BY ROWNUM) AS PRE_NTT_SJ,
	                       LAG(NTT_SJ,1) OVER (ORDER BY ROWNUM ) AS NEXT_NTT_SJ, 
	                       tb.* 
	                  FROM  (SELECT a.NTT_SJ, a.NTCR_ID, a.NTCR_NM, a.NTT_NO, a.NTT_CN,
							        a.PASSWORD, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
							        TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
						            a.NTCE_BGNDE, a.NTCE_ENDDE, a.RDCNT, 
							        a.USE_AT, a.ATCH_FILE_ID, a.BBS_ID, a.NTT_ID,
						            a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.SORT_ORDR,
							        c.BBS_TY_CODE, c.BBS_ATTRB_CODE, c.REPLY_POSBL_AT, 
						            c.FILE_ATCH_POSBL_AT, c.ATCH_POSBL_FILE_NUMBER, c.BBS_NM, 
						    	    (select CODE_NM from TC_CMMN_DETAIL_CODE where CODE = a.NTT_SE_CODE) as CODE_NM, 
							        a.ETC0, a.ETC1, a.ETC2, a.ETC3, a.ETC4, a.ETC5,
					                a.ETC6, a.ETC7, a.ETC8, a.ETC9, NVL(a.NOTICE_AT, 0) NOTICE_AT, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT, a.NTCE_DT AS NTCE_DT_H
					                ,a.CL1_DETAIL_CODE
					                ,a.CL2_DETAIL_CODE
									,a.CL3_DETAIL_CODE
					                ,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
									,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
									,(
										SELECT
											WM_CONCAT (DISTINCT '##'||TBK.KEYWORD)
										FROM
										 	TN_BBS_KEYWORD TBK
										 WHERE
										 TBK.BBS_ID = #bbsId#
										 AND TBK.NTT_ID = #nttId#
									) AS KEYWORD_TAG
									, a.THUMB_FILE_ID
									, a.METERIAL_ID
									, a.METERIAL_KNAME
									, a.METERIAL_CAS
									, (
										SELECT
											M_KNAME
										FROM
											TT_MATERIAL
										WHERE
											M_IDX = a.METERIAL_ID
									) AS METERIAL_NAME
							   FROM TN_BBS a
							   LEFT OUTER JOIN TN_BBS_MASTR c
							     ON a.BBS_ID = c.BBS_ID			
							  WHERE a.BBS_ID = #bbsId#	
								AND a.USE_AT = 'Y'
		]]>
							<isEqual property="confmSttus" compareValue="C">
								AND a.CONFM_STTUS_CODE = #confmSttus#
							</isEqual>
							<isEqual prepend="AND" property="searchCnd" compareValue="0">
								<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>
							<isEqual prepend="AND" property="searchCnd" compareValue="1">
								<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>	
							<isEqual prepend="AND" property="searchCnd" compareValue="2">
								<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>		
							
							<isEqual prepend="AND" property="searchCnd" compareValue="T0">
								<![CDATA[	( ( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.NTT_CN LIKE '%' || #searchWrd# || '%' ) ) ]]>
							</isEqual>				
							
							<isEqual prepend="AND" property="searchCnd" compareValue="TOT">
								<![CDATA[	(( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC0 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC1 LIKE '%' || #searchWrd# || '%' ))	]]>
							</isEqual>				
							<isEqual prepend="AND" property="searchCnd" compareValue="ETC0">
								<![CDATA[	a.ETC0 LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>
							<isEqual prepend="AND" property="searchCnd" compareValue="ETC1">
								<![CDATA[	a.ETC1 LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>	
							<isEqual prepend="AND" property="searchCnd" compareValue="ETC2">
								<![CDATA[	a.ETC2 LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>
										
							<isEqual prepend="AND" property="searchCnd" compareValue="01">
											a.ETC9 = '01' 	
							</isEqual>
							<isEqual prepend="AND" property="searchCnd" compareValue="02">
											a.ETC9 = '02' 	
							</isEqual>
							<isEqual prepend="AND" property="searchCnd" compareValue="03">
											a.ETC9 = '03' 	
							</isEqual>		
							
							<isEqual prepend="AND" property="searchCnd" compareValue="ALL">
								<![CDATA[	(( a.NTT_SJ LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC1 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC2 LIKE '%' || #searchWrd# || '%' ) OR ( a.ETC4 LIKE '%' || #searchWrd# || '%' ))	]]>
							</isEqual>				
							<isEqual prepend="AND" property="searchCnd" compareValue="ETC4">
								<![CDATA[	a.ETC4 LIKE '%' || #searchWrd# || '%' 		]]>
							</isEqual>		
							
							<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
								<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
							</isEqual>
							
							<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
								<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
							</isEqual>
							<isNotEmpty prepend="AND" property="searchCl1DetailCode" >
								<![CDATA[	a.CL1_DETAIL_CODE = #searchCl1DetailCode# 		]]>
							</isNotEmpty>								
		<![CDATA[
								
						   ORDER BY 
						   		CASE 
									WHEN ANSWER_AT='N' THEN 
										DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) 
									ELSE 
										(SELECT DECODE(NTCE_DT, NULL, FRST_REGIST_PNTTM, '', FRST_REGIST_PNTTM, NTCE_DT) FROM TN_BBS WHERE NTT_ID=A.PARNTSCTT_NO) 
								END DESC
						   		, a.SORT_ORDR DESC, NTT_NO ASC) tb 
							) z 
					 WHERE z.NTT_ID = #nttId#
		]]>				
	</select> 
 
 	<update id="BBSManageDAO.updateBoardArticle" parameterClass="Board">
 		/* BBSManageDAO.updateBoardArticle */
 		<![CDATA[
			UPDATE TN_BBS SET 
				NTT_SJ = #nttSj#,
				NTT_CN = #nttCn#, 
				NTCR_ID = #ntcrId#,
				NTCR_NM = #ntcrNm#,
				PASSWORD = #password#,
				NTCE_BGNDE = TO_DATE(#ntceBgnde#,'YYYY-MM-DD HH24:MI:SS'),		
				NTCE_ENDDE = TO_DATE(#ntceEndde#,'YYYY-MM-DD HH24:MI:SS'),		
				LAST_UPDUSR_ID = #lastUpdusrId#,
				ATCH_FILE_ID = #atchFileId#,
				LAST_UPDT_PNTTM = SYSDATE,
				ETC0 = #extStr0#,
				ETC1 = #extStr1#,
				ETC2 = #extStr2#,
				ETC3 = #extStr3#,
				ETC4 = #extStr4#,
				ETC5 = #extStr5#,
				ETC6 = #extStr6#,
				ETC7 = #extStr7#,
				ETC8 = #extStr8#,
				ETC9 = #extStr9#,
				PUBLIC_NURI_TY_CODE = #publicNuriTy#,
				NTCE_DT = TO_DATE(#ntceDate#,'YYYY-MM-DD HH24:MI:SS'),
				NOTICE_AT = #noticeAt#,
				NTT_SE_CODE = #nttSe#
				,CL1_DETAIL_CODE = #cl1DetailCode#
				,CL2_DETAIL_CODE = #cl2DetailCode#
				,CL3_DETAIL_CODE = #cl3DetailCode#
				, THUMB_FILE_ID = #thumbFileId#
				, METERIAL_ID = #meterialId#
				, METERIAL_KNAME = #meterialKname#
				, METERIAL_CAS = #meterialCas#
				, RDCNT = NVL2(#rdcnt#, #rdcnt#, 0)
				, CONFM_STTUS_CODE = #confmSttus#
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttId#
 		]]>
 	</update>

 	<update id="BBSManageDAO.deleteBoardArticle" parameterClass="Board">
 		/* BBSManageDAO.deleteBoardArticle */
 		<![CDATA[
			UPDATE TN_BBS SET 
				USE_AT = 'N',
				LAST_UPDUSR_ID = #lastUpdusrId#,
				LAST_UPDT_PNTTM = SYSDATE
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttId#
 		]]>
 	</update>

	<!-- 삭제파일 되살리기 -->
 	<update id="BBSManageDAO.deleteBoardArticlesUndo" parameterClass="Board">
 		/* BBSManageDAO.deleteBoardArticlesUndo */
 		<![CDATA[
			UPDATE TN_BBS SET 
				USE_AT = 'Y',
				LAST_UPDUSR_ID = #lastUpdusrId#,
				LAST_UPDT_PNTTM = SYSDATE
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttDocSe#
 		]]>
 	</update>

 	<select id="BBSManageDAO.selectMaxInqireCo" resultClass="java.lang.Integer" parameterClass="BoardVO">
 		/* BBSManageDAO.selectMaxInqireCo */
 		<![CDATA[
			SELECT NVL(MAX(RDCNT),0)+1 AS RDCNT FROM TN_BBS
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttId#
 		]]>
 	</select>
 	
 	<select id="BBSManageDAO.selectNoticeItemForSort" resultClass="java.lang.Long" parameterClass="Board">
 		/* BBSManageDAO.selectNoticeItemForSort */
 		<![CDATA[
			SELECT
				NVL(MAX(NTT_NO),0)+1 AS NTT_NO
			FROM
				TN_BBS	
			WHERE
				BBS_ID = #bbsId#
			AND
				SORT_ORDR = #sortOrdr#
			AND 
				NTT_ID = #nttId#	
 		]]>
 	</select> 	

 	<update id="BBSManageDAO.updateInqireCo" parameterClass="BoardVO">
 		/* BBSManageDAO.updateInqireCo */
 		<![CDATA[
			UPDATE TN_BBS SET 
				RDCNT = #inqireCo#,
				LAST_UPDUSR_ID = #lastUpdusrId#,
				LAST_UPDT_PNTTM = SYSDATE
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttId#
 		]]>
 	</update>

	<update id="BBSManageDAO.updateSortOrder" parameterClass="BoardVO">
 		/* BBSManageDAO.updateSortOrder */
 		<![CDATA[
			UPDATE TN_BBS SET 
				NTT_NO = #nttNo#
			WHERE NTT_ID = #nttId#
 		]]>	
	</update>

	<select id="BBSManageDAO.selectGuestList" parameterClass="BoardVO" resultMap="guestList" >
		/* BBSManageDAO.selectGuestList */
		<![CDATA[
		SELECT *,(SELECT ntt_cn FROM TN_BBS WHERE ntt_id=Z.ntt_id and BBS_ID=Z.BBS_ID and	 rownum=1) AS ntt_cn FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.NTCR_NM, a.PASSWORD, 
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD HH:MI:SS')
				as FRST_REGIST_PNTTM,
				a.USE_AT, a.BBS_ID, b.USER_NM as FRST_REGISTER_NM, a.FRST_REGISTER_ID, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT,a.NTCE_DT AS NTCE_DT_H
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
			FROM
				TN_BBS a, VN_USER_MASTER b
			WHERE
				a.BBS_ID = #bbsId#
			AND a.FRST_REGISTER_ID = b.ESNTL_ID
			AND a.USE_AT = 'Y'
			AND	a.CONFM_STTUS_CODE = 'C'
			ORDER BY a.SORT_ORDR DESC, a.NTT_NO ASC
			) TB ) Z WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
		]]>				
	</select>	
	
	<select id="BBSManageDAO.selectGuestListCnt" parameterClass="BoardVO" resultClass="java.lang.Integer" >
		/* BBSManageDAO.selectGuestListCnt */
		<![CDATA[
			SELECT
				COUNT(NTT_ID)
			FROM
				TN_BBS 
			WHERE
				BBS_ID = #bbsId#	
			AND USE_AT = 'Y'
			AND	a.CONFM_STTUS_CODE = 'C'
		]]>			
	</select>	

	<update id="BBSManageDAO.deleteGuestList" parameterClass="BoardVO">
		/* BBSManageDAO.deleteGuestList */
		<![CDATA[
			UPDATE TN_BBS
			SET USE_AT = 'N'
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttId#
		]]>			
	</update>	
	
	<select id="BBSManageDAO.getPasswordInf" parameterClass="Board" resultClass="java.lang.String">
		/* BBSManageDAO.getPasswordInf */
		<![CDATA[
			SELECT
				PASSWORD
			FROM
				TN_BBS	
			WHERE BBS_ID = #bbsId#
			AND NTT_ID = #nttId#				
		]]>
	</select>

	<select id="BBSManageDAO.getParentNttNo" parameterClass="Board" resultClass="java.lang.Long">
		/* BBSManageDAO.getParentNttNo */
		<![CDATA[
			SELECT NTT_NO FROM TN_BBS
			WHERE BBS_ID = #bbsId# AND NTT_ID = #parnts#			
		]]>
	</select>
	
 	<update id="BBSManageDAO.updateOtherNttNo" parameterClass="Board">
 		/* BBSManageDAO.updateOtherNttNo */
 		<![CDATA[
			UPDATE TN_BBS SET 
				NTT_NO = NTT_NO + 1
			WHERE BBS_ID = #bbsId# AND SORT_ORDR = #sortOrdr#
			AND NTT_NO > #nttNo#
 		]]>
 	</update>
 	
	 <update id="BBSManageDAO.updateNttNo" parameterClass="Board">
 		/* BBSManageDAO.updateNttNo */
 		<![CDATA[
			UPDATE TN_BBS SET 
				NTT_NO = #nttNo#
			WHERE BBS_ID = #bbsId# 
			AND NTT_ID = #nttId#
 		]]>
 	</update>
 	
	
	
	<select id="BBSManageDAO.selectImgBoardArticleList" parameterClass="BoardVO" resultMap="boardImgList" >
		/* BBSManageDAO.selectImgBoardArticleList */
		<![CDATA[
		SELECT Z.*,(SELECT NTT_CN FROM TN_BBS WHERE NTT_ID=Z.NTT_ID AND BBS_ID=Z.BBS_ID AND rownum=1) AS NTT_CN FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, TO_CHAR(a.NTCE_BGNDE,'YYYYMMDD') NTCE_BGNDE, TO_CHAR(a.NTCE_ENDDE,'YYYYMMDD') NTCE_ENDDE, ETC5,
				c.FILE_STRE_COURS, c.STRE_FILE_NM, c.ORIGNL_FILE_NM, c.FILE_EXTSN, NVL(a.NOTICE_AT, 0) NOTICE_AT, c.FILE_SN,
				a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT, a.NTCE_DT AS NTCE_DT_H , COUNT(1) OVER() AS TOT_CNT
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE 
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
			FROM
				TN_BBS a 
				LEFT OUTER JOIN 
				(
					SELECT ATCH_FILE_ID, FILE_STRE_COURS, STRE_FILE_NM, ORIGNL_FILE_NM, FILE_EXTSN, FILE_SN
						FROM TN_FILE_DETAIL
						WHERE 1=1
						
		]]>
					
			<isNotEqual prepend="AND" property="imgSearchCnd" compareValue="1">
				<![CDATA[	FILE_SN = 0 		]]>
			</isNotEqual>
			
			<isEqual prepend="AND" property="imgSearchCnd" compareValue="1">
				<![CDATA[	FILE_EXTSN IN ( 'jpg', 'JPG', 'gif', 'GIF', 'png', 'PNG', 'bmp', 'BMP')		]]>
			</isEqual>
						
				 ) c
			ON a.ATCH_FILE_ID = c.ATCH_FILE_ID
			WHERE a.BBS_ID = #bbsId#
			AND a.USE_AT = 'Y'

		
			<isEqual property="confmSttus" compareValue="C">
				AND a.CONFM_STTUS_CODE = #confmSttus#
			</isEqual>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>					
		<![CDATA[			
			ORDER BY 
		]]>
			<isEmpty property="subPageIndex">
				<![CDATA[	 NVL(A.NOTICE_AT, 0) DESC,	]]>
			</isEmpty>
			
		<![CDATA[	
				DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) DESC, a.SORT_ORDR DESC, NTT_NO ASC
			) TB ) Z 
		]]>				
		
			<isEqual property="bbsSearchTerm" compareValue="0">
				<![CDATA[	WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage# 		]]>
			</isEqual>
	</select>	
	
	
	<select id="BBSManageDAO.getVodFileSn" parameterClass="Board" resultClass="java.lang.String">
		/* BBSManageDAO.getVodFileSn */
		<![CDATA[
			SELECT
				FILE_SN
			FROM
				TN_FILE_DETAIL	
			WHERE ATCH_FILE_ID = #atchFileId#
			AND FILE_EXTSN IN ('AVI', 'avi', 'wmv', 'WMV')				
		]]>
	</select>
	
	
	<select id="BBSManageDAO.selectImgBoardArticleListCnt" parameterClass="BoardVO" resultClass="java.lang.Integer" >
		/* BBSManageDAO.selectImgBoardArticleListCnt */
		<![CDATA[
			SELECT
				COUNT(a.NTT_ID)
			FROM
				TN_BBS a 
				LEFT OUTER JOIN 
				(
					SELECT ATCH_FILE_ID, FILE_STRE_COURS, STRE_FILE_NM, ORIGNL_FILE_NM, FILE_EXTSN, FILE_SN
						FROM TN_FILE_DETAIL
						WHERE 1=1
		]]>
		
						<isNotEqual prepend="AND" property="imgSearchCnd" compareValue="1">
							<![CDATA[	FILE_SN = 0 		]]>
						</isNotEqual>
						
						<isEqual prepend="AND" property="imgSearchCnd" compareValue="1">
							<![CDATA[	FILE_EXTSN IN ( 'jpg', 'JPG', 'gif', 'GIF', 'png', 'PNG', 'bmp', 'BMP')		]]>
						</isEqual>
				 ) c
			ON a.ATCH_FILE_ID = c.ATCH_FILE_ID
			WHERE a.BBS_ID = #bbsId#
			AND a.USE_AT = 'Y'

			<isEqual property="confmSttus" compareValue="C">
				AND a.CONFM_STTUS_CODE = #confmSttus#
			</isEqual>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>		
			<isNotEmpty prepend="AND" property="password" >
				<![CDATA[	a.PASSWORD LIKE '%' || #password# || '%' 		]]>
			</isNotEmpty>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>	
	</select>
	
	
	<select id="BBSManageDAO.selectBoardArticleList_R" parameterClass="BoardVO" resultMap="boardList" >
		/* BBSManageDAO.selectBoardArticleList_R */
		<![CDATA[
		SELECT Z.*,(SELECT REPLACE(NTT_CN,'"', '') FROM TN_BBS WHERE ntt_id=Z.ntt_id and BBS_ID=Z.BBS_ID and	 rownum=1) AS ntt_cn FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, TO_CHAR(a.NTCE_BGNDE,'YYYYMMDD') NTCE_BGNDE, TO_CHAR(a.NTCE_ENDDE,'YYYYMMDD') NTCE_ENDDE, NTT_DOC_SE_CODE, 
				(select CODE_NM from TC_CMMN_DETAIL_CODE where CODE = a.NTT_SE_CODE) as CODE_NM, NVL(a.NOTICE_AT, 0) NOTICE_AT,
				a.ETC0, a.ETC1, a.ETC2, a.ETC3, a.ETC4, a.ETC5,
				a.ETC6, a.ETC7, a.ETC8, a.ETC9, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT ,a.NTCE_DT AS NTCE_DT_H ,a.NTT_SE_CODE,
				COUNT(1) OVER() AS TOT_CNT
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
				, a.THUMB_FILE_ID
				, a.METERIAL_ID
				, (
					SELECT
						M_KNAME
					FROM
						TT_MATERIAL
					WHERE
						M_IDX = a.METERIAL_ID
				) AS METERIAL_NAME
			FROM
				TN_BBS a
			WHERE
				a.BBS_ID = #bbsId#
			AND a.USE_AT = 'Y'
		]]>
		
			<isEqual property="confmSttus" compareValue="C">
				AND a.CONFM_STTUS_CODE = #confmSttus#
			</isEqual>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isNotEmpty prepend="AND" property="nttSe" >
				<![CDATA[	a.NTT_SE_CODE = #nttSe# 		]]>
			</isNotEmpty>	
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>						
		<![CDATA[			
			ORDER BY 
		]]>
			<isEmpty property="subPageIndex">
				<![CDATA[	 NVL(A.NOTICE_AT, 0) DESC,	]]>
			</isEmpty>
			
		<![CDATA[	
				CASE 
					WHEN ANSWER_AT='N' THEN 
						DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) 
					ELSE 
						(SELECT DECODE(NTCE_DT, NULL, FRST_REGIST_PNTTM, '', FRST_REGIST_PNTTM, NTCE_DT) FROM TN_BBS WHERE NTT_ID=A.PARNTSCTT_NO) 
				END DESC
				, a.SORT_ORDR DESC, NTT_NO ASC
			) TB ) Z 
		]]>				
		
			<isEqual property="bbsSearchTerm" compareValue="0">
				<![CDATA[	WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage# 		]]>
			</isEqual>	
	</select>	
	
	
	<select id="BBSManageDAO.selectImgBoardArticleList_R" parameterClass="BoardVO" resultMap="boardImgList" >
		/* BBSManageDAO.selectImgBoardArticleList_R */
		<![CDATA[
		SELECT *,(SELECT REPLACE(NTT_CN,'"', '') FROM TN_BBS WHERE ntt_id=Z.ntt_id and BBS_ID=Z.BBS_ID and	 rownum=1) AS ntt_cn FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, rtrim(a.NTCE_BGNDE) NTCE_BGNDE, rtrim(a.NTCE_ENDDE) NTCE_ENDDE, ETC5,
				c.FILE_STRE_COURS, c.STRE_FILE_NM, c.ORIGNL_FILE_NM, c.FILE_EXTSN, NVL(a.NOTICE_AT, 0) NOTICE_AT, c.FILE_SN, 
				a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT,a.NTCE_DT AS NTCE_DT_H , COUNT(1) OVER() AS TOT_CNT
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE 
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
			FROM
				TN_BBS a, TN_FILE_DETAIL c
			WHERE a.ATCH_FILE_ID = c.ATCH_FILE_ID
			AND c.file_sn = 0 and a.BBS_ID = #bbsId#
			AND a.USE_AT = 'Y'
		]]>
			
			<isEqual property="confmSttus" compareValue="C">
				AND a.CONFM_STTUS_CODE = #confmSttus#
			</isEqual>
			
			<isEqual prepend="AND" property="imgSearchCnd" compareValue="0">
				<![CDATA[	c.FILE_SN = 0 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="imgSearchCnd" compareValue="1">
				<![CDATA[	c.FILE_EXTSN IN ( 'jpg', 'JPG', 'gif', 'GIF', 'png', 'PNG', 'bmp', 'BMP')		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	b.USER_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>		
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>			
		<![CDATA[			
			ORDER BY 
		]]>
			<isEmpty property="subPageIndex">
				<![CDATA[	 NVL(A.NOTICE_AT, 0) DESC,	]]>
			</isEmpty>
			
		<![CDATA[	
				DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) DESC, a.SORT_ORDR DESC, NTT_NO ASC
			) TB ) Z 
		]]>			
		
			<isEqual property="bbsSearchTerm" compareValue="0">
				<![CDATA[	WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage# 		]]>
			</isEqual>
	</select>	
	
	<select id="BBSManageDAO.selectDialogReplyArticle" parameterClass="BoardVO" resultMap="boardDetail" >
		/* BBSManageDAO.selectDialogReplyArticle */
		<![CDATA[
			SELECT
				a.NTT_SJ, a.NTCR_ID, a.NTCR_NM, a.NTT_NO, a.NTT_CN,
				a.PASSWORD, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.NTCE_BGNDE, a.NTCE_ENDDE, a.RDCNT, 
				a.USE_AT, a.ATCH_FILE_ID, a.BBS_ID, a.NTT_ID,
				a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.SORT_ORDR,
				c.BBS_TY_CODE, c.BBS_ATTRB_CODE, c.REPLY_POSBL_AT, 
				c.FILE_ATCH_POSBL_AT, c.ATCH_POSBL_FILE_NUMBER, c.BBS_NM, 
				(select CODE_NM from TC_CMMN_DETAIL_CODE where CODE = a.NTT_SE_CODE) as CODE_NM, 
				a.ETC0, a.ETC1, a.ETC2, a.ETC3, a.ETC4, a.ETC5,
				a.ETC6, a.ETC7, a.ETC8, a.ETC9, NVL(a.NOTICE_AT, 0) NOTICE_AT, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT,a.NTCE_DT AS NTCE_DT_H
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
				,(
					SELECT
						/*LISTAGG('##'||TBK.KEYWORD, '') WITHIN GROUP(ORDER BY TBK.KEY_ID ASC)*/
						WM_CONCAT (DISTINCT '##'||TBK.KEYWORD)
					FROM
					 	TN_BBS_KEYWORD TBK
					 WHERE
					 TBK.BBS_ID = #bbsId#
					 AND TBK.NTT_ID = #nttId#
				) AS KEYWORD_TAG
				, a.THUMB_FILE_ID
				, a.METERIAL_ID
				, (
					SELECT
						M_KNAME
					FROM
						TT_MATERIAL
					WHERE
						M_IDX = a.METERIAL_ID
				) AS METERIAL_NAME
			FROM
				TN_BBS a
			LEFT OUTER JOIN 
				TN_BBS_MASTR c
			ON a.BBS_ID = c.BBS_ID			
			WHERE
				a.BBS_ID = #bbsId#	
			AND
				a.ETC9 = #nttId#
			AND
				a.ETC8 = '-1'	
				
				
		]]>				
	</select> 
	
	
	<select id="BBSManageDAO.selectBoardDialogArticleList" parameterClass="BoardVO" resultMap="boardList" >
		/* BBSManageDAO.selectBoardDialogArticleList */
		<![CDATA[
		SELECT *,(SELECT NTT_CN FROM TN_BBS WHERE ntt_id=Z.ntt_id and BBS_ID=Z.BBS_ID and	 rownum=1) AS ntt_cn FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, rtrim(a.NTCE_BGNDE) NTCE_BGNDE, rtrim(a.NTCE_ENDDE) NTCE_ENDDE, NTT_DOC_SE_CODE, 
				(select CODE_NM from TC_CMMN_DETAIL_CODE where CODE = a.NTT_SE_CODE) as CODE_NM, NVL(a.NOTICE_AT, 0) NOTICE_AT,
				a.ETC0, a.ETC1, a.ETC2, a.ETC3, a.ETC4, a.ETC5,
				a.ETC6, a.ETC7, a.ETC8, a.ETC9, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT ,a.NTCE_DT AS NTCE_DT_H ,a.NTT_SE_CODE,
				COUNT(1) OVER() AS TOT_CNT
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
				, a.THUMB_FILE_ID
				, a.METERIAL_ID
				, (
					SELECT
						M_KNAME
					FROM
						TT_MATERIAL
					WHERE
						M_IDX = a.METERIAL_ID
				) AS METERIAL_NAME
			FROM
				TN_BBS a
			WHERE
				a.BBS_ID = #bbsId#
			and a.USE_AT = 'Y'
			AND a.CONFM_STTUS_CODE = 'C'
			
		]]>
		
			<isEqual property="tmpStr" compareValue="100">
			
				<isNotEmpty prepend="AND" property="extStr3" >
					<![CDATA[	a.ETC3 = #extStr3# 	]]>
				</isNotEmpty>
				
				<isNotEmpty prepend="AND" property="password" >
					<![CDATA[	a.PASSWORD = #password# 	]]>
				</isNotEmpty>
				
			</isEqual>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="1">
				<![CDATA[	(a.NTCE_BGNDE<=TO_CHAR(SYSDATE,'YYYY-MM-DD') AND a.NTCE_ENDDE>=TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>
			
			<isEqual prepend="AND" property="searchBgnDe" compareValue="0">
				<![CDATA[	(a.NTCE_ENDDE<TO_CHAR(SYSDATE,'YYYY-MM-DD')) 		]]>
			</isEqual>				
		<![CDATA[			
			ORDER BY 
		]]>
			<isEmpty property="subPageIndex">
				<![CDATA[	 NVL(A.NOTICE_AT, 0) DESC,	]]>
			</isEmpty>
			
		<![CDATA[	
				CASE 
					WHEN ANSWER_AT='N' THEN 
						DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) 
					ELSE 
						(SELECT DECODE(NTCE_DT, NULL, FRST_REGIST_PNTTM, '', FRST_REGIST_PNTTM, NTCE_DT) FROM TN_BBS WHERE NTT_ID=A.PARNTSCTT_NO) 
				END DESC
				, a.SORT_ORDR DESC, NTT_NO ASC
			) TB ) Z 
		]]>					
		
			<isEqual property="bbsSearchTerm" compareValue="0">
				<![CDATA[	WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage# 		]]>
			</isEqual>	
	</select>	
	
	<select id="BBSManageDAO.selectBoardDialogArticleListCnt" parameterClass="BoardVO" resultClass="java.lang.Integer" >
		/* BBSManageDAO.selectBoardDialogArticleListCnt */
		<![CDATA[
			SELECT
				COUNT(a.NTT_ID)
			FROM
				TN_BBS a
			WHERE
				a.BBS_ID = #bbsId#
			and a.USE_AT = 'Y'
			AND a.CONFM_STTUS_CODE = 'C'
		]]>
			<isEqual property="tmpStr" compareValue="100">
			
				<isNotEmpty prepend="AND" property="extStr3" >
					<![CDATA[	a.ETC3 = #extStr3# 	]]>
				</isNotEmpty>
				
				<isNotEmpty prepend="AND" property="password" >
					<![CDATA[	a.PASSWORD = #password# 	]]>
				</isNotEmpty>
				
			</isEqual>
			
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTT_CN LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>	
			<isEqual prepend="AND" property="searchCnd" compareValue="2">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>		
	</select>
	
	<update id="BBSManageDAO.realDeleteBoardArticles" parameterClass="java.lang.String">
 		/* BBSManageDAO.realDeleteBoardArticles */
 		<![CDATA[
			DELETE FROM TN_BBS  				
			WHERE NTT_ID = #nttDocSe#
 		]]>
 	</update>
 	
 	<select id="BBSManageDAO.selectBoardArticles_obj" parameterClass="BoardVO" resultMap="boardList" >
		/* BBSManageDAO.selectBoardArticles_obj */
		<![CDATA[
		SELECT Z.*,(SELECT REPLACE(NTT_CN,'"', '') FROM TN_BBS WHERE ntt_id=Z.ntt_id and BBS_ID=Z.BBS_ID and	 rownum=1) AS ntt_cn FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ, a.FRST_REGISTER_ID, a.NTCR_NM as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, rtrim(a.NTCE_BGNDE) NTCE_BGNDE, rtrim(a.NTCE_ENDDE) NTCE_ENDDE, NTT_DOC_SE_CODE, 
				(select CODE_NM from TC_CMMN_DETAIL_CODE where CODE = a.NTT_SE_CODE) as CODE_NM, NVL(a.NOTICE_AT, 0) NOTICE_AT,
				a.ETC0, a.ETC1, a.ETC2, a.ETC3, a.ETC4, a.ETC5,
				a.ETC6, a.ETC7, a.ETC8, a.ETC9, a.PUBLIC_NURI_TY_CODE, a.CONFM_STTUS_CODE, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT ,a.NTCE_DT AS NTCE_DT_H , a.NTT_SE_CODE,
				COUNT(1) OVER() AS TOT_CNT
				,a.CL1_DETAIL_CODE
				,a.CL2_DETAIL_CODE
				,FN_CMMN_DETAIL_CODE_NM(a.CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
				,FN_CMMN_DETAIL_CODE_NM(a.CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
				, a.THUMB_FILE_ID
				, a.METERIAL_ID
				, (
					SELECT
						M_KNAME
					FROM
						TT_MATERIAL
					WHERE
						M_IDX = a.METERIAL_ID
				) AS METERIAL_NAME
			FROM
				TN_BBS a
			WHERE
				a.BBS_ID = #bbsId#
		]]>
			
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	a.NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	a.NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>				
		<![CDATA[			
			ORDER BY  a.NOTICE_AT DESC, DECODE(A.NTCE_DT, NULL, A.FRST_REGIST_PNTTM, '', A.FRST_REGIST_PNTTM, A.NTCE_DT) DESC, a.SORT_ORDR DESC, NTT_NO ASC
			) TB ) Z WHERE rn BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage# 
		]]>				
		
	</select>	
	
	<select id="BBSManageDAO.selectBoardArticles_objCnt" parameterClass="BoardVO" resultClass="java.lang.Integer" >
		/* BBSManageDAO.selectBoardArticles_objCnt */
		<![CDATA[
			SELECT
				COUNT(NTT_ID)
			FROM
				TN_BBS  
			WHERE  BBS_ID = #bbsId#
		]]>
		
			<isEqual prepend="AND" property="searchCnd" compareValue="0">
				<![CDATA[	NTT_SJ LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>
			<isEqual prepend="AND" property="searchCnd" compareValue="1">
				<![CDATA[	NTCR_NM LIKE '%' || #searchWrd# || '%' 		]]>
			</isEqual>		
	</select>
	
	<insert id="BBSManageDAO.insertBoardArticleLog" parameterClass="Board">
		<selectKey resultClass="java.lang.String" keyProperty="nttSn">
			SELECT NVL(MAX(NTT_SN), 0) + 1 
			  FROM TH_BBS_LOG S1 
			 WHERE S1.BBS_ID = #bbsId# 
			   AND S1.NTT_ID = #nttId#
		</selectKey>
		
		/* BBSManageDAO.insertBoardArticleLog */
		INSERT INTO TH_BBS_LOG(
			   NTT_ID
			 , BBS_ID
			 , NTT_SN
			 , NTT_NO
			 , NTT_SJ
			 , NTT_CN
			 , ANSWER_AT
			 , PARNTSCTT_NO
			 , ANSWER_LC
			 , SORT_ORDR
			 , RDCNT
			 , USE_AT
			 , NTCE_BGNDE
			 , NTCE_ENDDE
			 , NTCR_ID
			 , NTCR_NM
			 , PASSWORD
			 , ATCH_FILE_ID
			 , FRST_REGIST_PNTTM
			 , FRST_REGISTER_ID
			 , LAST_UPDT_PNTTM
			 , LAST_UPDUSR_ID
			 , NTT_SE_CODE
			 , RELATE_LINK
			 , NTT_DOC_SE_CODE
			 , NOTICE_AT
			 , BLTN_NO
			 , CL1_DETAIL_CODE
			 , CL2_DETAIL_CODE
			 , ETC0
			 , ETC1
			 , ETC2
			 , ETC3
			 , ETC4
			 , ETC5
			 , ETC6
			 , ETC7
			 , ETC8
			 , ETC9
			 , PUBLIC_NURI_TY_CODE
			 , CONFM_STTUS_CODE
			 , NTCE_DT
			 , ACTION_TY_CODE
			 , UPDUSR_IP
			 , REGIST_PNTTM
			 , THUMB_FILE_ID
			 , METERIAL_ID
		)
		SELECT NTT_ID
			 , BBS_ID
			 , #nttSn#
			 , NTT_NO
			 , NTT_SJ
			 , NTT_CN
			 , ANSWER_AT
			 , PARNTSCTT_NO
			 , ANSWER_LC
			 , SORT_ORDR
			 , RDCNT
			 , USE_AT
			 , NTCE_BGNDE
			 , NTCE_ENDDE
			 , NTCR_ID
			 , NTCR_NM
			 , PASSWORD
			 , ATCH_FILE_ID
			 , FRST_REGIST_PNTTM
			 , FRST_REGISTER_ID
			 , LAST_UPDT_PNTTM
			 , LAST_UPDUSR_ID
			 , NTT_SE_CODE
			 , RELATE_LINK
			 , NTT_DOC_SE_CODE
			 , NOTICE_AT
			 , BLTN_NO
			 , CL1_DETAIL_CODE
			 , CL2_DETAIL_CODE
			 , ETC0
			 , ETC1
			 , ETC2
			 , ETC3
			 , ETC4
			 , ETC5
			 , ETC6
			 , ETC7
			 , ETC8
			 , ETC9
			 , PUBLIC_NURI_TY_CODE
			 , CONFM_STTUS_CODE
			 , NTCE_DT
			 , #actionTy#
			 , #updusrIp#
			 , SYSDATE
			 , THUMB_FILE_ID
			 , METERIAL_ID
		  FROM TN_BBS	
		 WHERE BBS_ID = #bbsId#
		   AND NTT_ID = #nttId#
		   
	</insert>
	
	<insert id="BBSManageDAO.insertBoardArticleFileLog" parameterClass="Board">
		/* BBSManageDAO.insertBoardArticleFileLog */
		INSERT INTO TH_FILE_DETAIL_LOG(
			   NTT_ID
			 , BBS_ID
			 , NTT_SN
			 , FILE_SN
			 , FILE_STRE_COURS
			 , STRE_FILE_NM
			 , ORIGNL_FILE_NM
			 , FILE_EXTSN
			 , FILE_CN
			 , FILE_SIZE
			 , FILE_MASK
		)
		SELECT #nttId#
			 , #bbsId#
			 , #nttSn#
			 , FILE_SN
			 , FILE_STRE_COURS
			 , STRE_FILE_NM
			 , ORIGNL_FILE_NM
			 , FILE_EXTSN
			 , FILE_CN
			 , FILE_SIZE
			 , FILE_MASK
		  FROM TN_FILE_DETAIL	
		 WHERE ATCH_FILE_ID = (SELECT ATCH_FILE_ID 
		 						 FROM TN_BBS S1 
		 						WHERE S1.BBS_ID = #bbsId#
		 						  AND S1.NTT_ID = #nttId#)
		   
	</insert>
	
	<resultMap id="boardHistoryList" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="nttId" column="NTT_ID" />
		<result property="bbsId" column="BBS_ID" />
		<result property="nttSn" column="NTT_SN" />
		<result property="nttNo" column="NTT_NO" />
		<result property="nttSj" column="NTT_SJ" />
		<result property="nttCn" column="NTT_CN" />
		<result property="replyAt" column="ANSWER_AT" />		
		<result property="parnts" column="PARNTSCTT_NO" />
		<result property="replyLc" column="ANSWER_LC" />
		<result property="sortOrdr" column="SORT_ORDR" />
		<result property="inqireCo" column="RDCNT" />
		<result property="useAt" column="USE_AT" />
		<result property="ntceBgnde" column="NTCE_BGNDE" />
		<result property="ntceEndde" column="NTCE_ENDDE" />
		<result property="ntcrId" column="NTCR_ID" />
		<result property="ntcrNm" column="NTCR_NM" />
		<result property="atchFileId" column="ATCH_FILE_ID" />
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" />
		<result property="frstRegisterId" column="FRST_REGISTER_ID" />
		<result property="lastUpdtPnttm" column="LAST_UPDT_PNTTM" />
		<result property="lastUpdusrId" column="LAST_UPDUSR_ID" />
		<result property="lastUpdusrNm" column="LAST_UPDUSR_NM" />
		<result property="nttSe" column="NTT_SE_CODE" />
		<result property="relateLink" column="RELATE_LINK" />
		<result property="nttDocSe" column="NTT_DOC_SE_CODE" />
		<result property="noticeAt" column="NOTICE_AT" />
		<result property="bltnNo" column="BLTN_NO" />
		<result property="extStr0" column="ETC0" />		
		<result property="extStr1" column="ETC1" />
		<result property="extStr2" column="ETC2" />
		<result property="extStr3" column="ETC3" />
		<result property="extStr4" column="ETC4" />
		<result property="extStr5" column="ETC5" />
		<result property="extStr6" column="ETC6" />
		<result property="extStr7" column="ETC7" />
		<result property="extStr8" column="ETC8" />
		<result property="extStr9" column="ETC9" />
		<result property="publicNuriTy" column="PUBLIC_NURI_TY_CODE" />
		<result property="confmSttus" column="CONFM_STTUS_CODE" />
		<result property="ntceDate" column="NTCE_DT" />
		<result property="actionTy" column="ACTION_TY_CODE" />
		<result property="updusrIp" column="UPDUSR_IP" />
		<result property="ntceDateH" column="NTCE_DT_H" />
		<result property="cl1DetailCode" column="CL1_DETAIL_CODE" />
		<result property="cl2DetailCode" column="CL2_DETAIL_CODE" />
		<result property="cl1DetailCodeNm" column="CL1_DETAIL_CODE_NM" />
		<result property="cl2DetailCodeNm" column="CL2_DETAIL_CODE_NM" />
	</resultMap>
	
	<select id="BBSManageDAO.selectBBSHistory" parameterClass="Board" resultMap="boardHistoryList">
		/* BBSManageDAO.selectBBSHistory */
		SELECT NTT_ID
			 , BBS_ID
			 , NTT_SN
			 , NTT_NO
			 , NTT_SJ
			 , NTT_CN
			 , ANSWER_AT
			 , PARNTSCTT_NO
			 , ANSWER_LC
			 , SORT_ORDR
			 , RDCNT
			 , USE_AT
			 , NTCE_BGNDE
			 , NTCE_ENDDE
			 , NTCR_ID
			 , NTCR_NM
			 , ATCH_FILE_ID
			 , FRST_REGIST_PNTTM
			 , FRST_REGISTER_ID
			 , TO_CHAR(REGIST_PNTTM, 'YYYY-MM-DD HH24:MI') AS LAST_UPDT_PNTTM
			 , LAST_UPDUSR_ID
			 , NVL((SELECT USER_NM FROM TN_EMPLYR_INFO S1 WHERE S1.EMPLYR_ID = A.LAST_UPDUSR_ID), A.NTCR_NM) AS LAST_UPDUSR_NM
			 , NTT_SE_CODE
			 , RELATE_LINK
			 , NTT_DOC_SE_CODE
			 , NOTICE_AT
			 , BLTN_NO
			 , ETC0
			 , ETC1
			 , ETC2
			 , ETC3
			 , ETC4
			 , ETC5
			 , ETC6
			 , ETC7
			 , ETC8
			 , ETC9
			 , PUBLIC_NURI_TY_CODE
			 , CONFM_STTUS_CODE
			 , TO_CHAR(NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT 
			 , NTCE_DT AS NTCE_DT_H
			 , ACTION_TY_CODE
			 , UPDUSR_IP
			 , CL1_DETAIL_CODE
			 , CL2_DETAIL_CODE
			 , FN_CMMN_DETAIL_CODE_NM(CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
			 , FN_CMMN_DETAIL_CODE_NM(CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
		  FROM TH_BBS_LOG A
		 WHERE NTT_ID = #nttId#
		   AND BBS_ID = #bbsId#
		 ORDER BY NTT_SN DESC
				
	</select>
	
	<resultMap id="historyDetail" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="nttSj" column="NTT_SJ" />
		<result property="ntcrNm" column="NTCR_NM" />
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" />
		<result property="nttCn" column="NTT_CN" />
		<result property="atchFileId" column="ATCH_FILE_ID" />
		<result property="bbsTyCode" column="BBS_TY_CODE" />
		<result property="bbsAttrbCode" column="BBS_ATTRB_CODE" />
	</resultMap>
	<select id="BBSManageDAO.selectBBSHistoryPreview" parameterClass="BoardVO" resultMap="boardHistoryList" >
		/* BBSManageDAO.selectBBSHistoryPreview */
		SELECT A.NTT_ID
			 , A.BBS_ID
			 , A.NTT_SN
			 , A.NTT_NO
			 , A.NTT_SJ
			 , A.NTT_CN
			 , A.ANSWER_AT
			 , A.PARNTSCTT_NO
			 , A.ANSWER_LC
			 , A.SORT_ORDR
			 , A.RDCNT
			 , A.USE_AT
			 , A.NTCE_BGNDE
			 , A.NTCE_ENDDE
			 , A.NTCR_ID
			 , A.NTCR_NM
			 , A.ATCH_FILE_ID
			 , TO_CHAR(A.REGIST_PNTTM, 'YYYY-MM-DD HH24:MI:SS') AS FRST_REGIST_PNTTM
			 , A.FRST_REGISTER_ID
			 , A.LAST_UPDT_PNTTM
			 , A.LAST_UPDUSR_ID
			 , NVL((SELECT USER_NM FROM TN_EMPLYR_INFO S1 WHERE S1.EMPLYR_ID = A.LAST_UPDUSR_ID), A.NTCR_NM) AS LAST_UPDUSR_NM
			 , A.NTT_SE_CODE
			 , A.RELATE_LINK
			 , A.NTT_DOC_SE_CODE
			 , NVL(a.NOTICE_AT, 0) NOTICE_AT
			 , A.BLTN_NO
			 , A.ETC0
			 , A.ETC1
			 , A.ETC2
			 , A.ETC3
			 , A.ETC4
			 , A.ETC5
			 , A.ETC6
			 , A.ETC7
			 , A.ETC8
			 , A.ETC9
			 , A.PUBLIC_NURI_TY_CODE
			 , A.CONFM_STTUS_CODE
			 , TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT 
			 , A.NTCE_DT AS NTCE_DT_H
			 , A.ACTION_TY_CODE
			 , A.UPDUSR_IP
			 , A.REGIST_PNTTM
		 	 , B.BBS_TY_CODE 
		 	 , B.BBS_ATTRB_CODE
		 	 , (SELECT S1.CODE_NM FROM TC_CMMN_DETAIL_CODE S1  WHERE S1.CODE_ID='COM078' AND S1.CODE= B.BBS_SITE_CODE ) AS CODE_NM
		 	 , CL1_DETAIL_CODE
			 , CL2_DETAIL_CODE
			 , FN_CMMN_DETAIL_CODE_NM(CL1_DETAIL_CODE) as CL1_DETAIL_CODE_NM
			 , FN_CMMN_DETAIL_CODE_NM(CL2_DETAIL_CODE) as CL2_DETAIL_CODE_NM
		  FROM TH_BBS_LOG A
		  	 , TN_BBS_MASTR B
		 WHERE A.BBS_ID = B.BBS_ID
		   AND A.NTT_ID = #nttId#
		   AND A.BBS_ID = #bbsId#
		   AND A.NTT_SN = #nttSn#		
	</select> 
	
	<update id="BBSManageDAO.updateBBSOfHistory" parameterClass="Board">
		/* BBSManageDAO.updateBBSOfHistory */
		UPDATE TN_BBS A
		   SET (NTT_NO
			  , NTT_SJ
			  , NTT_CN
			  , ANSWER_AT
			  , PARNTSCTT_NO
			  , ANSWER_LC
			  , SORT_ORDR
			  , RDCNT
			  , USE_AT
			  , NTCE_BGNDE
			  , NTCE_ENDDE
			  , NTCR_ID
			  , NTCR_NM
			  , PASSWORD
			  , ATCH_FILE_ID
			  , FRST_REGIST_PNTTM
			  , FRST_REGISTER_ID
			  , LAST_UPDT_PNTTM
			  , LAST_UPDUSR_ID
			  , NTT_SE_CODE
			  , RELATE_LINK
			  , NTT_DOC_SE_CODE
			  , NOTICE_AT
			  , BLTN_NO
			  , CL1_DETAIL_CODE
			  , CL2_DETAIL_CODE
			  , ETC0
			  , ETC1
			  , ETC2
			  , ETC3
			  , ETC4
			  , ETC5
			  , ETC6
			  , ETC7
			  , ETC8
			  , ETC9
			  , PUBLIC_NURI_TY_CODE
			  , CONFM_STTUS_CODE
			  , THUMB_FILE_ID
			  , METERIAL_ID
			  , NTCE_DT) = (SELECT NTT_NO
								   , NTT_SJ
								   , NTT_CN
								   , ANSWER_AT
								   , PARNTSCTT_NO
								   , ANSWER_LC
								   , SORT_ORDR
								   , RDCNT
								   , 'Y'
								   , NTCE_BGNDE
								   , NTCE_ENDDE
								   , NTCR_ID
								   , NTCR_NM
								   , PASSWORD
								   , ATCH_FILE_ID
								   , FRST_REGIST_PNTTM
								   , FRST_REGISTER_ID
								   , LAST_UPDT_PNTTM
								   , LAST_UPDUSR_ID
								   , NTT_SE_CODE
								   , RELATE_LINK
								   , NTT_DOC_SE_CODE
								   , NOTICE_AT
								   , BLTN_NO
								   , CL1_DETAIL_CODE
			 					   , CL2_DETAIL_CODE
								   , ETC0
								   , ETC1
								   , ETC2
								   , ETC3
								   , ETC4
								   , ETC5
								   , ETC6
								   , ETC7
								   , ETC8
								   , ETC9
								   , PUBLIC_NURI_TY_CODE
								   , CONFM_STTUS_CODE
								   , THUMB_FILE_ID
								   , METERIAL_ID 
								   , NTCE_DT
								FROM TH_BBS_LOG S1
							   WHERE S1.NTT_ID = A.NTT_ID
								 AND S1.BBS_ID = A.BBS_ID
								 AND S1.NTT_SN = #nttSn#)
		 WHERE A.NTT_ID = #nttId#
		   AND A.BBS_ID = #bbsId#
		   
	</update>
	
	<update id="BBSManageDAO.deleteBBSFileDetail" parameterClass="Board">
		/* BBSManageDAO.deleteBBSFileDetail */
		DELETE FROM TN_FILE_DETAIL
		 WHERE ATCH_FILE_ID = (SELECT ATCH_FILE_ID 
		 						 FROM TH_BBS_LOG S1 
		 						WHERE S1.NTT_ID = #nttId#
								  AND S1.BBS_ID = #bbsId#
								  AND S1.NTT_SN = #nttSn#)
	</update>
	
	<update id="BBSManageDAO.insertBBSFileDetail" parameterClass="Board">
		/* BBSManageDAO.insertBBSFileDetail */
		INSERT INTO TN_FILE_DETAIL(
			   ATCH_FILE_ID
			 , FILE_SN
			 , FILE_STRE_COURS
			 , STRE_FILE_NM
			 , ORIGNL_FILE_NM
			 , FILE_EXTSN
			 , FILE_CN
			 , FILE_SIZE
			 , FILE_MASK
		)
		SELECT (SELECT ATCH_FILE_ID FROM TH_BBS_LOG S1
				 WHERE S1.NTT_ID = A.NTT_ID
				   AND S1.BBS_ID = A.BBS_ID
				   AND S1.NTT_SN = A.NTT_SN)
			 , FILE_SN
			 , FILE_STRE_COURS
			 , STRE_FILE_NM
			 , ORIGNL_FILE_NM
			 , FILE_EXTSN
			 , FILE_CN
			 , FILE_SIZE
			 , FILE_MASK 
		  FROM TH_FILE_DETAIL_LOG A
		 WHERE NTT_ID = #nttId#
		   AND BBS_ID = #bbsId#
		   AND NTT_SN = #nttSn#
	</update>
	
	<resultMap id="fileList" class="egovframework.com.cmm.service.FileVO">
		<result property="fileCn" column="FILE_CN" />
		<result property="fileSn" column="FILE_SN" />
		<result property="fileStreCours" column="FILE_STRE_COURS" />
		<result property="streFileNm" column="STRE_FILE_NM" />
		<result property="fileExtsn" column="FILE_EXTSN" />
		<result property="orignlFileNm" column="ORIGNL_FILE_NM" />
		<result property="fileMg" column="FILE_SIZE" />
	</resultMap>
	<select id="BBSManageDAO.selectBBSHistoryFileList" parameterClass="BoardVO" resultMap="fileList" >
 		/* BBSManageDAO.selectBBSHistoryFileList */
 		SELECT FILE_CN
		 	 , FILE_SN
		 	 , FILE_STRE_COURS
		 	 , STRE_FILE_NM
		 	 , FILE_EXTSN
		 	 , ORIGNL_FILE_NM
		 	 , FILE_SIZE
		  FROM TH_FILE_DETAIL_LOG
		 WHERE NTT_ID = #nttId#
		   AND BBS_ID = #bbsId#
		   AND NTT_SN = #nttSn#	
		<isNotEmpty property="fileSn">
		   AND FILE_SN = #fileSn#
		</isNotEmpty>
		 ORDER BY FILE_SN
 	</select>
 	
 	<resultMap id="waterPhoto" class="egovframework.com.cop.bbs.service.BoardVO">
		<result property="nttId" column="NTT_ID" />
		<result property="nttSj" column="NTT_SJ" />	
		<result property="ntcrNm" column="NTCR_NM" />
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" />
		<result property="atchFileId" column="ATCH_FILE_ID" />
		<result property="ntceDate" column="NTCE_DT" />
		<result property="ntceDateH" column="NTCE_DT_H" />		
	</resultMap>
	
 	<select id="BBSManageDAO.selectWaterMainPhoto" parameterClass="BoardVO" resultMap="waterPhoto" >
		/* BBSManageDAO.selectWaterMainPhoto */
			SELECT
				a.NTT_ID, a.NTT_SJ, a.NTCR_NM ,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM, a.ATCH_FILE_ID, TO_CHAR(a.NTCE_DT,'yyyy-mm-dd')  AS NTCE_DT,a.NTCE_DT AS NTCE_DT_H
			FROM
				TN_BBS a, TN_FILE_DETAIL c
			WHERE a.ATCH_FILE_ID = c.ATCH_FILE_ID
			AND a.BBS_ID = #bbsId#
			AND a.USE_AT = 'Y'
			AND a.CONFM_STTUS_CODE = 'C'
			AND a.NOTICE_AT = '1'
			AND c.FILE_EXTSN IN ( 'jpg', 'JPG', 'gif', 'GIF', 'png', 'PNG', 'bmp', 'BMP')
			ORDER BY NTCE_DT DESC, NTT_ID DESC, file_sn ASC LIMIT 1;
	</select> 
	
	<select id="BBSManageDAO.selectBBSFileList" parameterClass="Board" resultClass="egovMap">
		/* BBSManageDAO.selectBBSFileList */
		SELECT ATCH_FILE_ID
			 , FILE_SN
			 , FILE_STRE_COURS
			 , STRE_FILE_NM
			 , ORIGNL_FILE_NM
			 , FILE_EXTSN
			 , FILE_CN
			 , FILE_SIZE
			 , FILE_MASK
		  FROM TN_FILE_DETAIL
		 WHERE ATCH_FILE_ID = #atchFileId#

	</select> 
	
	<update id="BBSManageDAO.deleteBoardFileInfo" parameterClass="Board">
		/* BBSManageDAO.deleteBoardFileInfo */
		DELETE FROM TN_FILE_DETAIL
		 WHERE ATCH_FILE_ID = #atchFileId#
		
	</update>
	
	<update id="BBSManageDAO.insertBoardFileSn" parameterClass="egovMap">
		/* BBSManageDAO.insertBoardFileSn */
		INSERT INTO TN_FILE_DETAIL(
			   ATCH_FILE_ID
			 , FILE_SN
			 , FILE_STRE_COURS
			 , STRE_FILE_NM
			 , ORIGNL_FILE_NM
			 , FILE_EXTSN
			 , FILE_CN
			 , FILE_SIZE
			 , FILE_MASK
		)VALUES(
			   #atchFileId#
			 , #fileSn#
			 , #fileStreCours#
			 , #streFileNm#
			 , #orignlFileNm#
			 , #fileExtsn#
			 , #fileCn#
			 , #fileSize#
			 , #fileMask#
		)
		
	</update>
	
	<select id="BBSManageDAO.selectBBSList" parameterClass="Board" resultClass="egovMap">
		/* BBSManageDAO.selectBBSList */
		<![CDATA[
			SELECT MENU_ID
				 , UPPER_MENU_ID
				 , MENU_NM
				 , BBS_ID
			 FROM (SELECT ROWNUM + 1000 AS MENU_ID
						, T.BBS_NM AS MENU_NM
						, TO_NUMBER(REPLACE(T.BBS_SITE_CODE, 'SITE', '')) * 10 AS UPPER_MENU_ID
						, T.BBS_ID   
						, T.BBS_SITE_CODE
					FROM (SELECT A.BBS_ID
							   , A.BBS_NM
							   , A.BBS_SITE_CODE
							FROM TN_BBS_MASTR A
						   WHERE A.BBS_ID != #bbsId#
						     AND A.BBS_TY_CODE = (SELECT BBS_TY_CODE 
						   							FROM TN_BBS_MASTR S1 
						   						   WHERE S1.BBS_ID = #bbsId#)
						   ORDER BY A.BBS_SITE_CODE, A.BBS_NM) T
					
					UNION
							
					SELECT TO_NUMBER(REPLACE(CODE, 'SITE', '')) * 10 AS MENU_ID
						 , CODE_NM AS MENU_NM
						 , 1 AS UPPER_MENU_ID
						 , '' AS BBS_ID
						 , CODE AS BBS_SITE_CODE
					  FROM TC_CMMN_DETAIL_CODE W1 
					 WHERE W1.CODE_ID = 'COM078'		
					 
					) Z
			ORDER BY Z.BBS_SITE_CODE
			   	   , Z.MENU_ID
			]]>
			
	</select>
	
	<update id="BBSManageDAO.insertLinkBbs" parameterClass="Board" >
		/* BBSManageDAO.insertLinkBbs */
			INSERT INTO TN_BBS(
				    NTT_ID
				  , BBS_ID
				  , NTT_NO
				  , NTT_SJ
				  , NTT_CN
				  , ANSWER_AT
				  , PARNTSCTT_NO
				  , ANSWER_LC
				  , SORT_ORDR
				  , RDCNT
				  , USE_AT
				  , NTCE_BGNDE
				  , NTCE_ENDDE
				  , NTCR_ID
				  , NTCR_NM
				  , PASSWORD
				  , ATCH_FILE_ID
				  , FRST_REGIST_PNTTM
				  , FRST_REGISTER_ID
				  , LAST_UPDT_PNTTM
				  , LAST_UPDUSR_ID
				  , NTT_SE_CODE
				  , RELATE_LINK
				  , NTT_DOC_SE_CODE
				  , NOTICE_AT
				  , BLTN_NO
				  , CL1_DETAIL_CODE
			 	  , CL2_DETAIL_CODE
				  , ETC0
				  , ETC1
				  , ETC2
				  , ETC3
				  , ETC4
				  , ETC5
				  , ETC6
				  , ETC7
				  , ETC8
				  , ETC9
				  , PUBLIC_NURI_TY_CODE
				  , CONFM_STTUS_CODE
				  , NTCE_DT
			 )
			 SELECT #linkNttId#
				  , #linkBbsId#
				  , 1
				  , NTT_SJ
				  , NTT_CN
				  , ANSWER_AT
				  , PARNTSCTT_NO
				  , ANSWER_LC
				  , (SELECT NVL(MAX(SORT_ORDR),0)+1 FROM TN_BBS WHERE BBS_ID = #linkBbsId#)
				  , RDCNT
				  , USE_AT
				  , NTCE_BGNDE
				  , NTCE_ENDDE
				  , NTCR_ID
				  , NTCR_NM
				  , PASSWORD
				  , #linkAtchFileId#
				  , FRST_REGIST_PNTTM
				  , FRST_REGISTER_ID
				  , LAST_UPDT_PNTTM
				  , LAST_UPDUSR_ID
				  , NTT_SE_CODE
				  , RELATE_LINK
				  , NTT_DOC_SE_CODE
				  , NOTICE_AT
				  , BLTN_NO
				  , CL1_DETAIL_CODE
			 	  , CL2_DETAIL_CODE
				  , ETC0
				  , ETC1
				  , ETC2
				  , ETC3
				  , ETC4
				  , ETC5
				  , ETC6
				  , ETC7
				  , ETC8
				  , ETC9
				  , PUBLIC_NURI_TY_CODE
				  , CONFM_STTUS_CODE
				  , NTCE_DT
			   FROM TN_BBS
			  WHERE NTT_ID = #nttId#
			    AND BBS_ID = #bbsId#
	</update>
	
	<update id="BBSManageDAO.insertLinkAtchFile" parameterClass="Board">
		/* BBSManageDAO.insertLinkAtchFile */
		INSERT INTO TN_FILE(
			  ATCH_FILE_ID
			, FRST_REGIST_PNTTM
			, USE_AT
		) VALUES (
			  #linkAtchFileId#
			, SYSDATE
			, 'Y'
		)
		
	</update>
	
	<update id="BBSManageDAO.insertLinkAtchFileDetail" parameterClass="Board">
		/* BBSManageDAO.insertLinkAtchFileDetail */
		INSERT INTO TN_FILE_DETAIL(
			  ATCH_FILE_ID
			, FILE_SN
			, FILE_STRE_COURS
			, STRE_FILE_NM
			, ORIGNL_FILE_NM
			, FILE_EXTSN
			, FILE_CN
			, FILE_SIZE
			, FILE_MASK
			, FRST_REGIST_PNTTM
		)
		SELECT #linkAtchFileId#
			, FILE_SN
			, FILE_STRE_COURS
			, STRE_FILE_NM
			, ORIGNL_FILE_NM
			, FILE_EXTSN
			, FILE_CN
			, FILE_SIZE
			, FILE_MASK 
			, SYSDATE
		 FROM TN_FILE_DETAIL
		WHERE ATCH_FILE_ID = #atchFileId#
		
	</update>
	
	<select id="BBSManageDAO.selectRealCopyBbsInfo" parameterClass="Board" resultClass="egovMap">
		/* BBSManageDAO.selectRealCopyBbsInfo */
		SELECT NTT_NO
			 , NTT_SJ
			 , NTT_CN
			 , ANSWER_AT
			 , PARNTSCTT_NO
			 , ANSWER_LC
			 , SORT_ORDR
			 , RDCNT
			 , USE_AT
			 , NTCE_BGNDE
			 , NTCE_ENDDE
			 , NTCR_ID
			 , NTCR_NM
			 , PASSWORD
			 , ATCH_FILE_ID
			 , FRST_REGIST_PNTTM
			 , FRST_REGISTER_ID
			 , LAST_UPDT_PNTTM
			 , LAST_UPDUSR_ID
			 , NTT_SE_CODE
			 , RELATE_LINK
			 , NTT_DOC_SE_CODE
			 , NOTICE_AT
			 , BLTN_NO
			 , CL1_DETAIL_CODE
			 , CL2_DETAIL_CODE
			 , ETC0
			 , ETC1
			 , ETC2
			 , ETC3
			 , ETC4
			 , ETC5
			 , ETC6
			 , ETC7
			 , ETC8
			 , ETC9
			 , PUBLIC_NURI_TY_CODE
			 , CONFM_STTUS_CODE
			 , TO_CHAR(NTCE_DT,'yyyymmdd')  AS NTCE_DT 
			 , NTCE_DT AS NTCE_DT_H
		  FROM TN_BBS
		 WHERE BBS_ID = #bbsId#
		   AND NTT_ID = #nttId#
		
	</select>
	
	
</sqlMap>
